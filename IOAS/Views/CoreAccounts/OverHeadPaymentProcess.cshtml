@model IOAS.Models.OverHeadPaymentProcessModel

@{
    ViewBag.Title = "OverHeadPaymentProcess";
    Layout = "~/Views/Shared/_LayoutFluid.cshtml";
}

<style>
        input[type="checkbox"]{
  width: 30px; /*Desired width*/
  height: 30px; /*Desired height*/
}
    .vw-dts-bg .hgt-bg {
        background: #597df0;
        color: #fff;
    }

        .vw-dts-bg .hgt-bg label {
            font-size: 16px !important;
            color: #fff !important;
        }

        .vw-dts-bg .hgt-bg h4 {
            font-size: 18px !important;
            color: #fff;
        }

    .vw-dts-bg .hgt-bg-pl {
        background: #e11eda;
        color: #fff;
    }

        .vw-dts-bg .hgt-bg-pl label {
            font-size: 16px !important;
            color: #fff !important;
        }

        .vw-dts-bg .hgt-bg-pl h4 {
            font-size: 18px !important;
            color: #fff;
        }
</style>

<div class="row hd-tt-bg">
    <div class="col-md-12">
        <h4><b>OverHead PaymentProcess</b> </h4>
    </div>
</div>

@using (Html.BeginForm("OverHeadPaymentProcess", "CoreAccounts", FormMethod.Post, new { @class = "", role = "form", @id = "formOPP", @enctype = "multipart/form-data" }))
{
<div class="row">
    <div class="white-bg ad-navbar">
        <div class="col-md-2 ds-spl-bg">
            <div class="ds-icn">
                <i class="ion-ios-list-outline "></i>
            </div>
            <div class="ds-tt">
                <span class="required">From Date</span>
                <input type="text" class="form-control" autocomplete="off" name="FromDate" id="FromDate" />
                @Html.ValidationMessageFor(m => m.FromDate)
            </div>
        </div>
        <div class="col-md-2 ds-spl-bg">
            <div class="ds-tt">
                <span class="required"> To Date</span>
                <input type="text" class="form-control" autocomplete="off" name="ToDate" id="ToDate" />
                @Html.ValidationMessageFor(m => m.ToDate)
            </div>
        </div>
        <div class="col-md-2 ds-spl-bg">
            <div class="ds-tt">
                <span class="required">Category</span>
                @Html.DropDownListFor(m => m.Category, new SelectList(ViewBag.CategoryId, "id", "name"), "--Select--", new { @class = "form-control", @id = "Category" })
                @Html.ValidationMessageFor(m => m.Category)
            </div>
        </div>

        <div class="col-md-3 ds-spl-bg">
            <div class="ds-tt">
                <span class="required">Bank</span>
                @Html.DropDownListFor(m => m.BankId, new SelectList(ViewBag.Bank, "id", "name"), "--Select--", new { @class = "form-control", @id = "Bank" })
                @Html.ValidationMessageFor(m => m.BankId)
            </div>
        </div>
        <div class="col-md-3 ds-spl-bg">
            <div class="ds-tt">
                <input type="button" value="View" class="btn btn-primary mt-20" id="btnView" />
            </div>
        </div>

    </div>
</div>

<div class="row vw-dts-bg">
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12" >
                    <h3 class="mt-null">OverHead Posting List</h3>
                </div>               
            </div>

            <div class="grey-bg-adj bc-td-bg mb-lg">
                <div class="row">
                    <div class="col-md-12">
                       
                        <input type="button" id="SelectAll" onclick="SelectAll();" class="btn btn-primary" value="Select All" />
                        <input type="button" id="UnSelectAll"  class="btn btn-primary" value="UnSelect All" />
                        <div class="row">
                        <div class="col-md-3 pull-right ">
                            <input type="text" id="textsearch" class="form-control" onkeyup="searchmenu()" placeholder="Search">
                        </div>                           
                        </div><br />
                       <div class="bk-tb-scrl">                       
                            <table class="table table-bordered mb-null" id="tablelist">
                                <tbody>
                                    <tr>
                                        <td></td>
                                        <td><b>Reference No</b></td>
                                        <td><b>Proj No</b></td>
                                        @*<td><b>Bank</b></td>*@
                                        <td><b>Amount</b></td>
                                        <td><b>Date</b></td>
                                    </tr>                                 
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-3 pull-right" id="TOTALTDS">
                            <div class="reg-no custom-reg-no">
                                <div class="form-group custom-form-group">
                                    <label>Total Amount</label>
                                    @Html.TextBoxFor(m => m.Amount, new { @class = "form-control", @id = "TtlAmt", @readonly = true })
                                    @*<input type="text" class="form-control" autocomplete="off" readonly="readonly"  name="Amount" id="TtlAmt" />*@
                                </div>
                            </div>
                        </div>
                    
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>

<div class="row vw-dts-bg">
    <div class="col-md-offset-6  ds-spl-bg">
        <div class="ds-tt">
            <input type="button" value="Submit" class="btn btn-primary mt-20" id="btnSubmit" />
            <input type="button" onclick="window.location.href='@Url.Action("OverHeadPaymentProcessList", "CoreAccounts")';" class="btn btn-primary mt-20" value="Close" />
        </div>
    </div>
</div>
}

<script>
   
    $('#FromDate,#ToDate').datepicker({ maxDate: 0, dateFormat: 'dd-MM-yy', changeYear: true });
    $('#btnSubmit').click(function () {
        $('#formOPP').submit();
    });
    $('#btnView').click(function () {
        var FromDate = $("#FromDate").val();
        var ToDate = $("#ToDate").val();
        var Id = $("#Bank").val();
        var Category = $("#Category").val();
       
       
        if (FromDate != "" && ToDate != "" && Id != "" && Category != "") {
            $("#tablelist tr:not(:first)").empty();
            $('.loading-bg').removeClass('dis-none');
            $.ajax({
                type: "POST",
                data: JSON.stringify({ 'FromDate': FromDate, 'ToDate': ToDate, 'Id': Id, 'Category': Category }),
                url: '@Url.Action("GetOverHeadPostingList", "CoreAccounts")',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    var row;
                    var totalAmt = 0;
                    $("#TtlAmt").val(0);
                    if (result.length == 0) {
                        row += "<tr class='text-center'><td colspan='5'> No Records Found</td></tr>";
                    }
                    else{
                        $.each(result, function (i, v1) {
                            row += "<tr><td>" +
                                 "<input type='checkbox' name='List[" + v1.SlNo + "].Checkbox'  value='true' class='btn btn-info' checked/><input type='hidden' name='List[" + v1.SlNo + "].Id'  value=" + v1.Id + "><input type='hidden' name='List[" + v1.SlNo + "].OHNumber'  value=" + v1.OHNumber + ">"
                                   + "</td><td>" + v1.OHNumber + "</td><td>" + v1.ProjetNo +
                                   //"</td><td>" + v1.Bank +
                                   "</td><td>" + v1.Amt +
                                 "</td><td>" + v1.Date + "</td></tr>";
                            totalAmt += v1.Amt;
                        });
                    } 
                    
                    $("#TtlAmt").val(parseFloat(totalAmt.toFixed(2)));
                    $("#tablelist").append(row);
                    $('.loading-bg').addClass('dis-none');
                },
            })
        } else {
            $('#FailedAlert').html("Bank,Category,From Date,To Date field required");
            $('#Failed').modal('toggle');
        }
       
    });
    function searchmenu() {
        $text = $("#textsearch").val();
        $filter = $text.toLowerCase();
        $("#tablelist tr").filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf($filter) > -1)
        });
    }
    $(document).on('click', '#UnSelectAll', function ()
    {
        $("#tablelist input[type = 'checkbox']").prop('checked', false);
        CalculateAmount();

    });
    $(document).on('click', '#SelectAll', function () {

        $("#tablelist input[type = 'checkbox']").prop('checked', true);
        CalculateAmount();
    });
    $(document).on('click', '#tablelist input[type = "checkbox"]', function () {
        CalculateAmount();
    });
    function CalculateAmount() {
        var amt = 0;
        var amount = 0;
        $('#tablelist tr:not(:first)').each(function () {
            if ($(this).find('input[type = "checkbox"]').is(':checked')) {
                amt = parseFloat($(this).find('td:nth-child(4)').text()) || 0;
                amount += amt;
            }
        })
        $("#TtlAmt").val("");
        $("#TtlAmt").val(parseFloat(amount).toFixed(2));    
    }
</script>

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/FoolProof/mvcfoolproof.unobtrusive.min.js")" type="text/javascript"></script>