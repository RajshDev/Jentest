@model IOAS.Models.NegativeBalanceModel
@{
    ViewBag.Title = "Negative Balance";
    ViewBag.Subtitle = "Negative Balance";
    Layout = "~/Views/Shared/_LayoutFluid.cshtml";
}
<div class="row hd-tt-bg">
    <div class="col-md-4 pull-left">
        <h3>Negative Balance</h3>
    </div>
</div>

   <div class="row">
    <div class="white-bg ad-navbar">
        <div class="col-md-3 ds-spl-bg">
            <div class="ds-icn">
                <i class="ion-ios-list-outline "></i>
            </div>
            <div class="ds-tt">
                <span>Request Reference</span><br />
                <span>@Html.DisplayFor(m => m.SourceName)</span>
            </div>
        </div>
        <div class="col-md-3 ds-spl-bg">
            <div class="ds-icn">
                <i class="ion-ios-calendar-outline"></i>
            </div>
            @if (Model.ReferenceNumber != null)
            {
                <div class="ds-tt">
                    <span>Ref Number (WF / Tapal)</span>
                    <span>@Html.DisplayFor(m => m.ReferenceNumber)</span>


                </div>
            }
            else
            {
                <div class="ds-tt">
                    <span>Email Date</span><br />
                    <span>@Html.DisplayFor(m => m.SourceEmail)</span>
                </div>
            }
        </div>
        <div class="col-md-3 col-md-offset-3">
            <div class="reg-no custom-reg-no">
                <div class="form-group custom-form-group">
                    <label>Number</label>
                    <h4>@Html.DisplayFor(m => m.NegativeBalanceNumber)</h4>
                </div>
            </div>
        </div>
    </div>

</div>

    <div class="vw-dts-bg">
        <div class="row">
            <div class="col-md-12">
                <table class="table table-bordered mb-null">
                    <tr>
                        <td colspan="2">
                            <label>Project Number</label>
                            @Html.HiddenFor(m => m.PIId, new { @id = "txtPIId" })
                        </td>
                        <td colspan="2">
                            <h4>
                            <a href="javascript:void(0)" class="btnViewSummary">@Html.DisplayFor(M => M.ProjectNumber)</a>
                           </h4>
                           
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Project Date</label>
                        </td>
                        <td>
                            <label>Start Date</label>
                            <h4>@Model.prjDetails.StartDate</h4>
                        </td>
                        <td>
                            <label>End Date</label>
                            <h4><b>@Model.prjDetails.CloseDate</b></h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Project Type</label>
                        </td>
                        <td colspan="2">
                            <h4>@Model.prjDetails.ProjectType</h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Funding Agency</label>
                        </td>
                        <td colspan="2">
                            <h4>@Model.AgencyCode</h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>PI Name</label>
                        </td>
                        <td colspan="2">
                            <h4>@Model.prjDetails.PIname</h4>
                            <span class="col-md-4" id="spanPIID" style="display: none;"> </span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>PI Department</label>
                        </td>
                        <td colspan="2">
                            <h4>@Model.PIDepartmentName</h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Sanctioned Value</label>
                        </td>
                        <td colspan="2">
                            <h4>@Model.prjDetails.SanctionedValue</h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Total Receipt</label>
                        </td>
                        <td colspan="2">
                            <h4>@Model.prjDetails.TotalGrantReceived</h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Grant yet to be Received</label>
                        </td>
                        <td colspan="2">
                            <h4><b>@Model.GranttobeReceived</b></h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Negative Balance Amount</label>
                        </td>
                        <td colspan="2">
                            <h4><b>@Model.ClaimAmount</b></h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Net Balance</label>
                        </td>
                        <td colspan="2">
                            <h4><b>@Model.prjDetails.NetBalance</b></h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Request Date</label>
                        </td>
                        <td colspan="2">
                            <h4>@Model.RequestDate</h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <label>Remarks</label>
                            <h4>@Model.Remarks</h4>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <label>Attachments</label>
                        </td>
                        <td>
                            <a href="@Url.Action("ShowDocument","Project",new { file = Model.DocumentName, filepath = Model.DocumentPath })" target="_blank">@Model.DocumentActualName</a>
                        </td>
                        <td>
                            <a href="javascript:void(0)" id="lnkBillHistory">View previous bill history</a>
                            <div id="popup"></div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
<div class="row">
    @if (Model.PFInit != true)
    {
        <div class="col-md-12 text-center pd-tb-30">

            <input type="button" onclick="window.location.href='@Url.Action("NegativeBalanceList", "CoreAccounts")';" class="btn btn-default" value="Close" id="btnclose" />
        </div>
    }
    else
    {
        <div class="col-md-12 text-center pd-tb-30">

            <input type="button" onclick="window.location.href='@Url.Action("Dashboard", "Home")';" class="btn btn-default" value="Close" id="btnclose" />
        </div>
    }
</div>
<input type="hidden" id="currentRefId" value="@Model.NegativeBalanceId" />
<input type="hidden" id="processGuideLineId" value="@ViewBag.processGuideLineId" />
@Html.Partial("_ProcessStatus")
<script type="text/javascript">
   
    $(document).ready(function () {

        $('#lnkBillHistory').click(function () {
            var PIID = $('input[name = "PIId"]').val();

            var projectId = '@Model.ProjectId';
            if (projectId != '') {

                var searchData = { "ProjectId": projectId, "Piid": PIID };
                $.ajax({
                    url: "@Url.Action("PrevNegativeBalance", "CoreAccounts")",
                    type: "POST",
                    data: searchData,
                    contentType: "application/x-www-form-urlencoded",
                    success: function (data) {
                        $("#popup").html(data);
                        $("#prevNegbalHistoryModal").modal('toggle');
                    },
                    error: function (err) {
                        console.log("error : " + err);
                    }
                });
            }


        });
        

    });

   

    

    $(document).on('click', 'a.btnViewSummary', function () {
        var projNo = '@Model.ProjectNumber' || '';
        var PIID = $('input[name = "PIId"]').val();
        if (projNo != '') {
            //var token = $("input[name=__RequestVerificationToken]").val();
            var searchData = { "projectNo": projNo, "Piid": PIID };
            $.ajax({
                url: "@Url.Action("_ProjectSummary", "CoreAccounts")",
                type: "POST",
            data: searchData,
            contentType: "application/x-www-form-urlencoded",
            success: function (data) {
                $("#popup").html(data);
                $("#projectSummaryModal").modal('toggle');
            },
            error: function (err) {
                console.log("error : " + err);
            }
        });
    }
    });
    

   
   


</script>

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
