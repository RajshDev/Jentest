@model IOAS.Models.STEViewModel
@using IOAS.GenericServices
@{
    ViewBag.Title = "Short Term Engagement";
    Layout = "~/Views/Shared/_LayoutFluid.cshtml";
    <link href="@Url.Content("~/Content/IOASContent/assets/bootstrap-select/css/bootstrap-select.min.css")" rel="stylesheet" />
}

<div class="row hd-tt-bg">
    <div class="col-md-12">
        <h4><b>Application View</b></h4>
    </div>
</div>
<div class="row cust-tab">
    <div class="page-wrapper mt30">
        <div>
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-6">
                        <div class="bl-lg-panel-box pb-null">
                            <div class="cmn-panel-box">
                                <div class="row ">
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            @Html.HiddenFor(m => m.appid)
                                            @Html.HiddenFor(m => m.orderid)
                                            @Html.HiddenFor(m => m.appType)
                                            @Html.HiddenFor(M => M.DesignationId)
                                            <label>Application No: </label>
                                            <h4 id="ClApplicationNo">@Html.DisplayFor(M => M.ApplicationNo)</h4>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>Candidate Name: </label>
                                            <h4 id="ClCandidate">@Html.DisplayFor(M => M.Name)</h4>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>PI Name:</label> <br>
                                            <h4 id="ClPIName">@Html.DisplayFor(M => M.ProjectDetailsModel.PIName)</h4>

                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>Department name:</label> <br>
                                            <h4 id="ClDepartname">@Html.DisplayFor(M => M.ProjectDetailsModel.PIDepartmentName)</h4>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>M.S/Ph.D:</label> <br>
                                            @if (Model.PhdDetail != null)
                                            {
                                                <h4 id="ClMSPhd">@Html.DisplayFor(M => M.PhdDetail)</h4>
                                            }
                                            else
                                            {
                                                <h4 id="ClMSPhd">-</h4>
                                            }
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>Designation: </label>
                                            <h4 id="ClDesignation"></h4>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>Qualification: </label>
                                            <h4 id="ClQualification">@Html.Raw(Model.Qualification)</h4>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>Experience: </label>
                                            <h4 id="ClExperience">@Html.DisplayFor(M => M.Experience)</h4>
                                        </div>
                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>Pay: </label>
                                            <h4 id="ClPay">@Html.DisplayFor(M => M.BasicPay)</h4>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>Medical:</label> <br>
                                            <h4 id="ClMedical">@Html.DisplayFor(M => M.MedicalAmmount)</h4>

                                        </div>
                                    </div>
                                </div>

                                <div class="row ">

                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>DOB </label>
                                            <h4>@Html.DisplayFor(M => M.DateofBirth)</h4>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group  ">
                                            <label>Application Received Date</label>
                                            <h4>@Html.DisplayFor(M => M.ApplicationReceiveDate)</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="row ">
                                    @if (Model.ConsolidatedPay || Model.Fellowship)
                                    {
                                        <div class="col-md-6">
                                            <div class="form-group custom-form-group">
                                                <label>Pay category:</label>
                                                @if (Model.ConsolidatedPay)
                                                {
                                                    <h4 id="ClPayCategory">Consolidated Pay</h4>
                                                }
                                                else if (Model.Fellowship)
                                                {
                                                    <h4 id="ClPayCategory">Consolidated Pay</h4>
                                                }
                                            </div>
                                        </div>
                                    }
                                    <div class="col-md-6" id="CldivCSIR">
                                        <div class="form-group custom-form-group ">
                                            <label>IITM Pensioner / CSIR Staff :</label>
                                            <h4>@Html.DisplayFor(M => M.IITMPensionerOrCSIRStaff)</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group  mb-sm">
                                            <label>Staff category:</label>
                                            <h4 id="ClStaffCategory">@Model.StaffCategory</h4>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            @if (Model.STEId > 0 && Model.PIJustificationDocuments != null)
                                            {
                                                if (Model.PIJustificationDocuments.Count > 0)
                                                {
                                                    <label>PI Justification Document</label> <br>
                                                    foreach (var item in Model.PIJustificationDocuments)
                                                    {
                                                        <h4>@Html.ActionLink(item.FileName, "ShowDocument", new { Controller = "Account", filepath = "Requirement", file = item.FilePath }, new { @name = "DocDownload", @target = "_blank" })</h4>
                                                    }
                                                }
                                            }
                                            <div id="fileAppend">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            @if (Model.PIJustificationCommands != null)
                                            {
                                                if (Model.PIJustificationCommands.Count > 0)
                                                {
                                                    <label>PI Comments</label>
                                                    foreach (var Note in Model.PIJustificationCommands)
                                                    {
                                                        <h4>@Note</h4>
                                                    }
                                                }
                                            }
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group custom-form-group">
                                            <label>DA Comments</label>
                                            <h4>@Html.DisplayFor(M => M.Comments)</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    @if (Model.isCommiteeRejection)
                                    {
                                        <div class="col-md-6">
                                            <div class="form-group custom-form-group ">
                                                <label>Committee Comments</label>
                                                <h4>@Html.DisplayFor(M => M.CommitteeRemark)</h4>
                                                <em style="font-size:12px;color:red;">@Html.DisplayFor(M => M.CommitteeApprovedBy)</em>
                                            </div>
                                        </div>
                                    }
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="bl-lg-panel-box  pb-null">
                            <div class="bl-lg-panel-box-hd mb-m-5 pd-null">
                                <div class="cmn-panel-box">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>Project Number</label>
                                                <h4 id="txtProjectNumber">@Html.DisplayFor(M => M.ProjectNumber)</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>Project Title</label>
                                                <h4 id="txtProjectTitle1">@Html.DisplayFor(M => M.ProjectDetailsModel.ProjectTitle)</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>Name of the Client / Sponsoring Agency</label>
                                                <h4 id="txtClietAgency1">@Html.DisplayFor(M => M.ProjectDetailsModel.SponsoringAgency)</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>Project Type</label>
                                                <h4 id="txtProjectType1">@Html.DisplayFor(M => M.ProjectDetailsModel.ProjectType)</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>PI Name</label>
                                                <h4 id="txtPIName1">@Html.DisplayFor(M => M.ProjectDetailsModel.PIName)</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>Project Start Date</label>
                                                <h4 id="txtProjectStartDate1">@Html.DisplayFor(M => M.ProjectDetailsModel.ProjectStartDate)</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>Project Closure Date</label>
                                                <h4 id="txtProjectClosureDate1">@Html.DisplayFor(M => M.ProjectDetailsModel.ProjectClosureDate)</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>PI Code</label>
                                                <h4 id="txtPICode1">@Html.DisplayFor(M => M.ProjectDetailsModel.PICode)</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>PI Email ID</label>
                                                <h4 id="txtPIEmailID1">@Html.DisplayFor(M => M.ProjectDetailsModel.Email)</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>PI Phone No</label>
                                                <h4 id="txtPIPhone1">@Html.DisplayFor(M => M.ProjectDetailsModel.Phone)</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>Department code </label>
                                                <h4 id="txtDepartmentCode1">@Html.DisplayFor(M => M.ProjectDetailsModel.PIDepartmentCode)</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group mb-sm">
                                                <label>Department Name</label>
                                                <h4 id="txtDepartmentName1">@Html.DisplayFor(M => M.ProjectDetailsModel.PIDepartmentName)</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label>Medical</label> <br>
                                                <h4>@Html.DisplayFor(M => M.MedicalINWordings)</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label>Designation Code</label>
                                                <h4 id="lblDesignationCode1"></h4>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label>Designation</label>
                                                <h4 id="lblDesignationName1"></h4>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label>Appointment start date</label>
                                                <input type="text" value="@Model.Appointmentstartdate" class="form-control" id="" disabled>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label>Appointment End date</label>
                                                <input type="text" value="@Model.AppointmentEndDate" class="form-control" id="" disabled>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label>Commitment Amount</label>
                                                <input type="text" value="@Model.CommitmentAmount" class="form-control" id="" disabled>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label>Committee member</label>
                                                @Html.TextBoxFor(m => m.CommiteeMember1, new { @class = "form-control", @readonly = "readonly" })
                                                @Html.HiddenFor(m => m.CommiteeMemberId1)
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label>Committee member</label>
                                                @Html.TextBoxFor(m => m.CommiteeMember2, new { @class = "form-control", @readonly = "readonly" })
                                                @Html.HiddenFor(m => m.CommiteeMemberId2)
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group custom-form-group">
                                                <label> Chairperson</label>
                                                @Html.TextBoxFor(m => m.ChairpersonName, new { @class = "form-control", @readonly = "readonly" })
                                                @Html.HiddenFor(m => m.ChairpersonNameId)
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        @if (Model.isCommiteeRejection)
                                        {
                                            <div class="col-md-12">
                                                <div class="form-group custom-form-group">
                                                    <label> PI Justification</label>
                                                    <input type="file" id="attachment" style="width:auto;">
                                                </div>
                                            </div>
                                        }
                                        <div class="col-md-12">
                                            <div class="form-group custom-form-group">
                                                <label> Comments</label>
                                                @Html.TextArea("Comments", null, new { @class = "form-control" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="text-center" style="margin-bottom: 50px;">
    @if (Model.isCommiteeRejection)
    {
        <button type="button" id="btnSubmitCommitteeApprove" class="btn btn-success">Send for committee approval</button>
    }
    else if (Model.CommitmentRejection)
    {
        <button type="button" id="btnSubmitCommitment" class="btn btn-success">Send for commitment booking</button>
    }
    else if (Model.isGovAgencyNoFund && Model.Status == "Open")
    {
        <button type="button" id="btnSubmitGov" class="btn btn-success">Send for Commitement Booking</button>
    }


    @Html.HiddenFor(m => m.List_f)
    @if (!string.IsNullOrEmpty(Model.List_f))
    {
        <button type="button" class="btn btn-default" onclick="window.location.href='@Url.Action(Model.List_f,"Requirement")';">Close</button>
    }
    else
    {
        <button type="button" class="btn btn-default" onclick="window.location.href='@Url.Action("Dashboard", "Home")';">Close</button>
    }

</div>
<div class="loading-bg dis-none">
</div>
<input type="hidden" id="currentRefId" value="@ViewBag.RefId" />
<input type="hidden" id="processGuideLineId" value="@ViewBag.processGuideLineId" />
<div id="act-now">
    @Html.Partial("_ProcessStatus")
</div>
<script>
    var errMsg = '@TempData["errMsg"]';
    var succMsg = '@TempData["succMsg"]';
    var CommitmentRemark = @Html.Raw(Json.Encode(Model.CommitmentRemark)) || "";
    var ApplicationId = @Html.Raw(Json.Encode(Model.appid)) || 0;
    var ApplicationType = @Html.Raw(Json.Encode(Model.appType)) || "";
    var OrderId = @Html.Raw(Json.Encode(Model.orderid)) || null;

    $(document).ready(function () {
        if(ApplicationType == "STE")
        {
            if(ApplicationId > 0){
                $('#Medical').val(@Model.Medical);
            }
        }

        if (succMsg != '') {
            $('#alertSuccess').html(succMsg);
            $('#Success').modal('toggle');
        }
        else if (errMsg != '') {
            $('#FailedAlert').html(errMsg);
            $('#Failed').modal('toggle');
        }

        if (CommitmentRemark != '') {
            $.confirm({
                title: 'Commitment rejection reason!',
                content:CommitmentRemark,
                type: 'orange',
                buttons: {
                    Close: function () {
                        //close
                    },
                },
            });
        }

    });
    if ($("#DesignationId").val() > 0) {
        LoadFillDesignation()
    }
    //$('#ReqCommitment').click(function(){
    //    if($(this).is(':checked')){
    //        $('#act-now').removeClass('dis-none');
    //    }
    //    else{
    //        $('#act-now').addClass('dis-none');
    //    }
    //});
    //if($('#ReqCommitment').is(':checked')){
    //    $('#act-now').removeClass('dis-none');
    //}
    //else{
    //    $('#act-now').addClass('dis-none');
    //}
    function LoadFillDesignation()
    {
        var DesignationID = $('#DesignationId').val();
        if (DesignationID > 0)
        {
            $.getJSON("@Url.Action("LoadDesignationDetails", "Requirement")", { DesignationID: DesignationID },
            function (result) {
                if (result.DesignationData.DestinationID > 0) {
                    $('#lblDesignationCode1').text(result.DesignationData.DesignationCode);
                    $('#lblDesignationName1').text(result.DesignationData.Designation);
                    $('#ClDesignation').text(result.DesignationData.Designation);
                }
            });
        }
    }
    $('a[name="DocDownload"]').click(function (p) {
        p.preventDefault();
        var ref = $(this).attr('href');
        var win = window.open('', '_blank');
        win.location.href = ref;
    });

    var isFundUnvailable = @Json.Encode(Model.isFundAvailable) || false;
    $('#btnSubmitCommitment,#btnSubmitGov').click(function(p) {
        p.preventDefault();
        var id = $(this).attr('id');
        if(id =='btnSubmitGov')
        {
            if(isFundUnvailable)
            {
                $.alert("Project fund is not available.");
                return;
            }
        }
        $.ajax({
            type: "POST",
            url: '@Url.Action("SenforCommitmentBooking", "Requirement")',
            data: {
                appid : ApplicationId,
                apptype : ApplicationType,
                orderid : OrderId,
                Comments : $('#Comments').val()
            },
            beforeSend: function () {
                $(".loading-bg").removeClass('dis-none');
            },
            success: function (result)
            {
                $(".loading-bg").addClass('dis-none');
                if (result)
                {
                    $.confirm({
                        title: 'Success Message!',
                        content:'Sent for commitement booking.',
                        type: 'green',
                        buttons: {
                            Close: function () {
                                if(@Json.Encode(Model.Adminintif) == true) {
                                    var url = '@Url.Action("DAApplicationStatus", "Requirement")';
                                    window.location.href = url;
                                }
                                else {
                                    if(ApplicationType == "STE") {
                                        var url = '@Url.Action("STEList", "Requirement")';
                                        window.location.href = url;
                                    }
                                    else if(ApplicationType == "CON") {
                                        var url = '@Url.Action("ConsultantAppointmentList", "Requirement")';
                                        window.location.href = url;
                                    }
                                    else if(ApplicationType == "OSG") {
                                        var url = '@Url.Action("OutsourcingList", "Requirement")';
                                        window.location.href = url;
                                    }
                                }
                            },
                        },
                    });
                }
                else
                {
                    $.confirm({
                        title: 'Error Message!',
                        content:'Sorry something went wrong.',
                        type: 'green',
                        buttons: {
                            Close: function () {
                                if(@Json.Encode(Model.Adminintif) == true){
                                    var url = '@Url.Action("DAApplicationStatus", "Requirement")';
                                    window.location.href = url;
                                }
                                else {
                                    if(ApplicationType == "STE") {
                                        var url = '@Url.Action("STEList", "Requirement")';
                                        window.location.href = url;
                                    }
                                    else if(ApplicationType == "CON") {
                                        var url = '@Url.Action("ConsultantAppointmentList", "Requirement")';
                                        window.location.href = url;
                                    }
                                    else if(ApplicationType == "OSG") {
                                        var url = '@Url.Action("OutsourcingList", "Requirement")';
                                        window.location.href = url;
                                    }
                                }
                            },
                        },
                    });
                }
            },
            error: function (err) {
                $(".loading-bg").addClass('dis-none');
                console.log("error1 : " + err);
            }
        });
    });
    $('#btnSubmitCommitteeApprove').click(function(p) {
        p.preventDefault();
        var data = new FormData();
        data.append("appid", ApplicationId);
        data.append("apptype", ApplicationType);
        data.append("orderid", OrderId);
        data.append("Comments", $('#Comments').val());
        $('input[type="file"]').each(function (idx,e) {
            var files = this.files[0];
            data.append("attachement", files);
        });
        $.ajax({
            type: "POST",
            url: '@Url.Action("SendCommitteeApproval", "Requirement")',
            contentType: false,
            processData: false,
            dataType: 'json',
            data: data,
            cache: false,

            success: function (result)
            {
                if (result)
                {
                    $.confirm({
                        title: 'Success Message!',
                        content:'Sent for committee approval.',
                        type: 'green',
                        buttons: {
                            Close: function () {
                                if(@Json.Encode(Model.Adminintif) == true){
                                    var url = '@Url.Action("DAApplicationStatus", "Requirement")';
                                    window.location.href = url;
                                }
                                else{
                                    if(ApplicationType == "STE") {
                                        var url = '@Url.Action("STEList", "Requirement")';
                                        window.location.href = url;
                                    }
                                    else if(ApplicationType == "CON") {
                                        var url = '@Url.Action("ConsultantAppointmentList", "Requirement")';
                                        window.location.href = url;
                                    }
                                    else if(ApplicationType == "OSG") {
                                        var url = '@Url.Action("OutsourcingList", "Requirement")';
                                        window.location.href = url;
                                    }
                                }
                            },
                        },
                    });
                }
                else
                {
                    $.confirm({
                        title: 'Error Message!',
                        content:'Sorry something went wrong.',
                        type: 'green',
                        buttons: {
                            Close: function () {
                                if(@Json.Encode(Model.Adminintif) == true){
                                    var url = '@Url.Action("DAApplicationStatus", "Requirement")';
                                    window.location.href = url;
                                }
                                else{
                                     if(ApplicationType == "STE") {
                                        var url = '@Url.Action("STEList", "Requirement")';
                                        window.location.href = url;
                                    }
                                    else if(ApplicationType == "CON") {
                                        var url = '@Url.Action("ConsultantAppointmentList", "Requirement")';
                                        window.location.href = url;
                                    }
                                    else if(ApplicationType == "OSG") {
                                        var url = '@Url.Action("OutsourcingList", "Requirement")';
                                        window.location.href = url;
                                    }
                                }
                            },
                        },
                    });
                }
            },
            error: function (err) {
                console.log("error1 : " + err);
            }
        });
    });
</script>
<script src="@Url.Content("~/Content/IOASContent/assets/bootstrap-select/js/bootstrap-select.min.js")"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/FoolProof/mvcfoolproof.unobtrusive.min.js")" type="text/javascript"></script>